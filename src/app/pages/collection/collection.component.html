<div class="collection-container container fade-in">
  <section class="collection-info-section">
    <div class="collection-info-inner">
      <h1 class="collection-title">Collection T-Shirts AURADHOM</h1>
      <p class="collection-lead">Découvrez la nouvelle collection de t-shirts AURADHOM, pensée pour les esprits libres et les passionnés de style simple mais affirmé.</p>
      <p class="collection-text">Chaque pièce est conçue pour offrir confort, élégance et durabilité. Nos t-shirts sont disponibles en cinq couleurs intemporelles — blanc, noir, beige, marron et gris — pour s'adapter à chaque personnalité.</p>
    </div>
  </section>

  <!-- Barre de recherche et tri -->
  <section class="search-sort-bar">
    <div class="search-wrapper">
      <input 
        type="search" 
        placeholder="Rechercher un produit..." 
        class="search-input"
        (input)="onSearchChange($any($event.target).value)"
        [value]="searchQuery()"
        aria-label="Rechercher">
      <button class="search-icon" aria-label="Rechercher">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </button>
    </div>
    
    <div class="controls">
      <select class="sort-select" (change)="onSortChange($any($event.target).value)" [value]="sortBy()" aria-label="Trier">
        <option value="popular">Populaires</option>
        <option value="price-asc">Prix croissant</option>
        <option value="price-desc">Prix décroissant</option>
        <option value="new">Nouveautés</option>
      </select>
      
      <button class="filter-toggle" (click)="toggleFilter()" [class.active]="isFilterOpen()" aria-label="Filtres">
        <svg class="icon-filter" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span>Filtres</span>
      </button>
    </div>
  </section>

  <!-- Compteur résultats -->
  <div class="results-info">
    <p>{{ filteredProducts().length }} produit(s) trouvé(s)</p>
    @if(searchQuery() || (filterForm.value.silhouette?.length || filterForm.value.type?.length || filterForm.value.matiere?.length || filterForm.value.teinte?.length)) {
      <button class="clear-btn" (click)="clearFilters()">Réinitialiser</button>
    }
  </div>

  <!-- Sidebar filtres -->
  <div class="filters-sidebar" [class.open]="isFilterOpen()">
    <div class="filters-header">
      <h2>Filtres</h2>
      <button class="close-filters" (click)="toggleFilter()" aria-label="Fermer filtres">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form [formGroup]="filterForm" class="filters-form">
      <div class="filter-group">
        <h3>Tailles</h3>
        @for(size of filterOptions.silhouette; track size) {
          <label class="checkbox-item">
            <input 
              type="checkbox" 
              [value]="size" 
              (change)="onCheckboxChange($event, 'silhouette')">
            <span>{{ size }}</span>
          </label>
        }
      </div>

      <div class="filter-group">
        <h3>Type</h3>
        @for(type of filterOptions.type; track type) {
          <label class="checkbox-item">
            <input 
              type="checkbox" 
              [value]="type" 
              (change)="onCheckboxChange($event, 'type')">
            <span>{{ type }}</span>
          </label>
        }
      </div>

      <div class="filter-group">
        <h3>Matière</h3>
        @for(mat of filterOptions.matiere; track mat) {
          <label class="checkbox-item">
            <input 
              type="checkbox" 
              [value]="mat" 
              (change)="onCheckboxChange($event, 'matiere')">
            <span>{{ mat }}</span>
          </label>
        }
      </div>

      <div class="filter-group">
        <h3>Couleur</h3>
        @for(color of filterOptions.teinte; track color) {
          <label class="checkbox-item">
            <input 
              type="checkbox" 
              [value]="color" 
              (change)="onCheckboxChange($event, 'teinte')">
            <span>{{ color }}</span>
          </label>
        }
      </div>
    </form>
  </div>

  <!-- Overlay filtres mobile -->
  @if(isFilterOpen()) {
    <div class="filters-overlay" (click)="toggleFilter()"></div>
  }

  <main class="product-grid-container">
    <div class="product-grid">
      @for(product of filteredProducts(); track product.id) {
        <div class="product-card">
          <div class="product-image-wrapper">
            <a [routerLink]="['/produit', product.slug]" class="product-link">
              <img [src]="getPreview(product)" [alt]="product.name" class="product-main-image">
            </a>
          </div>
          <div class="product-info">
            <div class="product-details">
              <span class="product-name">{{ product.name }}</span>
              @if(product.colors.length) {
                <span class="product-color">{{ product.colors[0].name }}</span>
              }
              @if(product.sizes.length) {
                <span class="product-sizes">Tailles: {{ product.sizes.join(', ') }}</span>
              }
            </div>
            <span class="product-price">{{ product.price | formatFcfa }}</span>
          </div>
          <div class="product-actions">
            <a [routerLink]="['/produit', product.slug]" class="buy-button">Acheter</a>
          </div>
          <div class="thumb-row" aria-label="Galerie">
            @if(thumbsById()[product.id] && thumbsById()[product.id].length > 0) {
              @for(img of thumbsById()[product.id].slice(0,3); track img; let idx = $index) {
                <button 
                  type="button" 
                  class="thumb" 
                  [class.active]="getPreview(product) === img"
                  (click)="setPreview(product.id, img)" 
                  [attr.aria-label]="'Vue ' + (idx + 1)">
                  <img [src]="img" [alt]="'Vue ' + (idx + 1)">
                </button>
              }
            } @else {
              @for(color of product.colors; track color.name) {
                <button type="button" class="thumb" (click)="setPreview(product.id, resolveColorImage(color.name))" [attr.aria-label]="'Prévisualiser ' + color.name">
                  <img [src]="resolveColorImage(color.name)" [alt]="'Miniature ' + color.name">
                </button>
              }
            }
          </div>
        </div>
      } @empty {
        <p class="no-results">Aucun produit ne correspond à votre sélection.</p>
      }
    </div>
  </main>
</div>
