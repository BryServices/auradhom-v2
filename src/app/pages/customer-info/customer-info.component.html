<div class="customer-form-container container fade-in">
    <div class="form-header">
        <h2 class="form-title">Informations de livraison</h2>
        <p class="form-subtitle">Remplissez les champs ci-dessous pour finaliser votre commande</p>
    </div>
    
    @if (!showSummary) {
        <form [formGroup]="customerForm" (ngSubmit)="onSubmit()" class="customer-form">
        <div class="form-group">
            <label class="form-label" for="lastName">Nom</label>
            <input 
                id="lastName"
                type="text"
                class="form-control"
                formControlName="lastName"
                [class.is-invalid]="customerForm.get('lastName')?.invalid && customerForm.get('lastName')?.touched">
            @if (customerForm.get('lastName')?.invalid && customerForm.get('lastName')?.touched) {
                <div class="error-message">Le nom est requis</div>
            }
        </div>

        <div class="form-group">
            <label class="form-label" for="firstName">Prénom</label>
            <input 
                id="firstName"
                type="text"
                class="form-control"
                formControlName="firstName"
                [class.is-invalid]="customerForm.get('firstName')?.invalid && customerForm.get('firstName')?.touched">
            @if (customerForm.get('firstName')?.invalid && customerForm.get('firstName')?.touched) {
                <div class="error-message">Le prénom est requis</div>
            }
        </div>

        <div class="form-group">
            <label class="form-label" for="department">Département</label>
            <select 
                id="department"
                class="form-control"
                formControlName="department"
                [class.is-invalid]="customerForm.get('department')?.invalid && customerForm.get('department')?.touched">
                <option value="">Sélectionnez un département</option>
                @for (dept of departments; track dept.id) {
                    <option [value]="dept.id">{{dept.name}}</option>
                }
            </select>
            @if (customerForm.get('department')?.invalid && customerForm.get('department')?.touched) {
                <div class="error-message">Le département est requis</div>
            }
        </div>

        <div class="form-group">
            <label class="form-label" for="city">Ville</label>
            <select 
                id="city"
                class="form-control"
                formControlName="city"
                [class.is-invalid]="customerForm.get('city')?.invalid && customerForm.get('city')?.touched">
                <option value="">Sélectionnez une ville</option>
                @for (city of cities; track city.id) {
                    <option [value]="city.id">{{city.name}}</option>
                }
            </select>
            @if (customerForm.get('city')?.invalid && customerForm.get('city')?.touched) {
                <div class="error-message">La ville est requise</div>
            }
        </div>

        <div class="form-group">
            <label class="form-label" for="district">Quartier</label>
            @if (!customDistrict) {
                <select 
                    id="district"
                    class="form-control"
                    formControlName="district"
                    [class.is-invalid]="customerForm.get('district')?.invalid && customerForm.get('district')?.touched">
                    <option value="">Sélectionnez un quartier</option>
                    @for (district of districts; track district) {
                        <option [value]="district">{{district}}</option>
                    }
                </select>
            } @else {
                <input 
                    type="text"
                    class="form-control"
                    formControlName="district"
                    placeholder="Saisissez votre quartier"
                    [class.is-invalid]="customerForm.get('district')?.invalid && customerForm.get('district')?.touched">
            }
            @if (customerForm.get('district')?.invalid && customerForm.get('district')?.touched) {
                <div class="error-message">Le quartier est requis</div>
            }
            <button type="button" class="custom-district-toggle" (click)="toggleCustomDistrict()">
                {{ customDistrict ? 'Sélectionner dans la liste' : 'Mon quartier n\'est pas dans la liste' }}
            </button>
        </div>

        <div class="form-group">
            <label class="form-label" for="address">Adresse complète</label>
            <textarea 
                id="address"
                class="form-control"
                formControlName="address"
                rows="3"
                [class.is-invalid]="customerForm.get('address')?.invalid && customerForm.get('address')?.touched"></textarea>
            @if (customerForm.get('address')?.invalid && customerForm.get('address')?.touched) {
                <div class="error-message">L'adresse est requise</div>
            }
        </div>

        <div class="form-group">
            <label class="form-label" for="phone">Numéro de téléphone</label>
            <input 
                id="phone"
                type="tel"
                class="form-control"
                formControlName="phone"
                placeholder="+242 XX XXX XXXX"
                [class.is-invalid]="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched">
            @if (customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched) {
                <div class="error-message">
                    @if (customerForm.get('phone')?.errors?.['required']) {
                        Le numéro de téléphone est requis
                    } @else if (customerForm.get('phone')?.errors?.['pattern']) {
                        Format invalide
                    }
                </div>
            }
        </div>

        <button 
            type="submit" 
            class="submit-button"
            [disabled]="customerForm.invalid">
            Vérifier les informations
        </button>
    </form>
    } @else {
        <div class="summary-section">
            <div class="summary-header">
                <h3>Récapitulatif de vos informations</h3>
                <p class="summary-subtitle">Vérifiez que tout est correct avant de confirmer</p>
            </div>
            
            <div class="summary-grid">
                <div class="summary-item">
                    <span class="summary-label">Nom</span>
                    <span class="summary-value">{{ getFormattedValue('lastName') }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Prénom</span>
                    <span class="summary-value">{{ getFormattedValue('firstName') }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Département</span>
                    <span class="summary-value">{{ getFormattedValue('department') }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Ville</span>
                    <span class="summary-value">{{ getFormattedValue('city') }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Quartier</span>
                    <span class="summary-value">{{ getFormattedValue('district') }}</span>
                </div>
                <div class="summary-item full-width">
                    <span class="summary-label">Adresse complète</span>
                    <span class="summary-value">{{ getFormattedValue('address') }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Téléphone</span>
                    <span class="summary-value">{{ getFormattedValue('phone') }}</span>
                </div>
            </div>
            
            <div class="summary-actions">
                <button type="button" class="edit-button" (click)="editInfo()">
                    Modifier
                </button>
                <button type="button" class="confirm-button" (click)="confirmOrder()">
                    Confirmer la commande
                </button>
            </div>
        </div>
    }
</div>